
<img id="main_img" src="image3.jpg" alt="">
<style>
	#main_img{
		user-drag: none; 
user-select: none;
-moz-user-select: none;
-webkit-user-drag: none;
-webkit-user-select: none;
-ms-user-select: none;	
	}
	#cropmate_div {
  	position: relative;
	}
	#crop_vp{
		position: absolute;
		background-color: transparent;
		border:1px solid red;
	}
</style>
<script>

	var img = new Image();
	img.onload = function() {
	  // alert(this.width + 'x' + this.height);

	  	var elem_div = document.createElement("div");
		elem_div.id = "cropmate_div";
		elem_div.style.width = get("main_img").naturalWidth + 'px';
		elem_div.style.height = get("main_img").naturalHeight + 'px';
		// alert(elem_div.style.width);
		//console.log( get("main_img").style);
		elem_div.appendChild(get("main_img"));
		document.body.appendChild(elem_div);
		
		elem_div.onclick = function (event) {
		if(get("crop_vp"))
		{
			get("crop_vp").remove();
		}
		var elem_div_crop = document.createElement("div");
		elem_div_crop.style.width = "50px";
		elem_div_crop.style.height = "50px";
		// console.log(event.clientX);
		// console.log(event.clientY); 
	// elem_div_crop.style.backgroundColor = "red";

		elem_div_crop.id = "crop_vp";
		var x = event.pageX - this.offsetLeft;
        var y = event.pageY - this.offsetTop;
		elem_div_crop.style.left = x + "px";
		elem_div_crop.style.top = y + "px";
		elem_div.appendChild(elem_div_crop);
		elem_div.insertBefore(elem_div_crop,elem_div.firstChild);

  elem_div.addEventListener('mousedown', mouseDown, false);
    window.addEventListener('mouseup', mouseUp, false);

		// elem_div_crop.addEventListener("mouseover", moverfunc(elem_div_crop,event), false);
		//elem_div_crop.addEventListener("mouseout", moutfunc(elem_div_crop,event), false);
    	// window.addEventListener('mouseup', moutfunc(elem_div_crop,event), false);

		

		// var img = new Image();
		// img.src = get("main_img").src;
		// img.src = 'image3.jpg';
		// document.body.appendChild(crop(img, event.clientX, event.clientY, 550, 250));
		crop(img, x, y, 50,50);
	}
	}
	img.src = 'image3.jpg';

	
	


// var canvas = document.getElementById('canvas');
// var context = canvas.getContext('2d');

// var image = new Image();
// image.onload = function() {
//   var sourceX = 100; var sourceY = 50;
//   var sourceWidth = 395; var sourceHeight = 128;
  
//   var destWidth = sourceWidth; var destHeight = sourceHeight;
//   var x = canvas.width / 2 - destWidth / 2; var y = canvas.height / 2 - destHeight / 2;
//   context.drawImage(this, sourceX, sourceY, sourceWidth, sourceHeight, x, y, destWidth, destHeight);
// };



function mouseUp()
{
    window.removeEventListener('mousemove', divmuv, true);
}

function mouseDown(e){
  window.addEventListener('mousemove', divmuv, true);
}

function divmuv(e){
    var div = document.getElementById('crop_vp');
  div.style.position = 'absolute';
  div.style.top = (e.clientY - 50)+ 'px';
  div.style.left = (e.clientX - 50) + 'px';
}
function moverfunc(elem_div_crop,e){
	  window.addEventListener('mousemove', moveon(elem_div_crop,e), true);

}
function moveon(elem_div_crop,e){
	elem_div_crop.style.position = "absolute";
	elem_div_crop.style.top = e.clientY - (e.clientY - elem_div_crop.offsetTop + 25) + "px";
	elem_div_crop.style.left = e.clientX - (e.clientX - elem_div_crop.offsetLeft + 25) + "px";
	console.log('test');
}

function moutfunc(elem_div_crop,e){
	 window.removeEventListener('mousemove', elem_div_crop, true);
}

function crop(image, x1, y1, x2, y2) {
	if(document.getElementById('canvasid'))
		document.getElementById('canvasid').remove();
	console.log(image);
	// var canvas = document.createElement('canvas');
	var canvas = document.getElementById('canvas');
	canvas.width = x2;
	canvas.height = y2;
	var context = canvas.getContext('2d')
	// var sourceX = 100; var sourceY = 50;
	// var sourceWidth = 395; var sourceHeight = 128;

	var sourceX = x1; var sourceY = y1;
	var sourceWidth = x2; var sourceHeight = y2;

	var destWidth = sourceWidth; var destHeight = sourceHeight;
	var x = canvas.width / 2 - destWidth / 2; 
	var y = canvas.height / 2 - destHeight / 2;
	// console.log(canvas.width);
	// console.log(image, sourceX, sourceY, sourceWidth, sourceHeight, x, y, destWidth, destHeight);
	context.drawImage(image, sourceX, sourceY, sourceWidth, sourceHeight, x, y, destWidth, destHeight);
}

	function get(id){
		return document.getElementById(id);
	}
</script>
<canvas id="canvas" width="500" height="500"></canvas>